def solvecase n = int next stdin f = list map lambda s int s - 1 next stdin split c = - 1 * n vis = set for i in range n p = j = i while j not in vis p append j vis add j j = f j for d k in enumerate p - 1 if k == j break if k == j for k in p - 1 c k = d + 1 if k == j break m = max c frev = for _ in range n for i j in enumerate f frev j append i d = - 1 * n t = - 1 * n for i in range n if c i == 2 d i = 1 t i = i c2 = i for i in range n if c i == 2 q = i i for i in c2 while q i t = q pop 0 for j in frev i if d j == - 1 or d j > d i + 1 d j = d i + 1 t j = t q append j t p = - 1 * n for i d t in zip range n d t if p t < d p t = d return max m sum d for d in p if d >= 0 		5 51
