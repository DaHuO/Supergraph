def find_longest u forb rev ans = 0 if u not in rev return 1 for x in rev u if x == forb continue ans = max ans find_longest x - 1 rev return 1 + ans 		4 12
def solve n p dead = set best = 0 special_sum = 0 rev = dict for i x in enumerate p if x not in rev rev x = rev x append i + 1 for i in range 1 n + 1 if i in dead continue seen = dict cnt = 1 j = i while j not in seen seen j = cnt cnt += 1 j = p j - 1 cyc_len = cnt - seen j if cyc_len > 2 best = max best cyc_len for x in seen dead add x else u v = j p j - 1 if u in dead continue dead add u dead add v special_sum += find_longest u v rev + find_longest v u rev return max best special_sum 		14 50
