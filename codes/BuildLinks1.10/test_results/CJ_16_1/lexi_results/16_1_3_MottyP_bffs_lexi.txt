def _measure start friend judgement curr = start prev = prevset = set if judgement curr is not none return while true jud = judgement curr if jud is none and curr in prevset where = prev index curr for p in prev where judgement p = out val = cycle len prev - where for p in prev where judgement p = val return if jud is none prev append curr prevset add curr curr = friend curr continue if jud == out or isinstance jud tuple and jud 0 == cycle for p in prev judgement p = out return if jud == pair target = curr length = 0 break if isinstance jud tuple and jud 0 == leading _ target length = jud break lenp = len prev for i p in enumerate prev judgement p = leading target length + lenp - i 		14 49
def _domain inp = sys stdin ncases = int inp readline for cs in range 1 ncases + 1 n = int inp readline friend = int part - 1 for part in inp readline split assert len friend == n print case #%d: %d % cs largestcircle friend 		72 79
def largestcircle friend n = len friend judgement = none * n _findpairs friend judgement for start in xrange n _measure start friend judgement cyclesizes = j 1 for j in judgement if isinstance j tuple and j 0 == cycle cyclesizes append 0 maxcycle = max cyclesizes maxleading = ind 0 for ind in xrange n if judgement ind == pair numpairmembers = len maxleading for j in judgement if isinstance j tuple and j 0 == leading _ target length = j maxleading target = max maxleading target length mostleading = sum maxleading values return max maxcycle numpairmembers + mostleading 		51 70
def _findpairs friend judgement for x in xrange len friend y = friend x if x == friend y judgement x = judgement y = pair 		8 12
