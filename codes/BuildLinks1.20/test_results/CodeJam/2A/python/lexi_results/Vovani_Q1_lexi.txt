def solve n r p s pos = for opt in rps layers = anc opt for i in xrange 1 n layers append map lambda letter anc letter sum layers i - 1 lineup = sum layers len layers - 1 r p s = lineup count r lineup count p lineup count s if r == r and p == p and s == s pos append layers len layers - 1 if len pos == 0 return impossible sorted_lineups = for p in pos cur = p for layer in xrange n - 1 merged = for i in xrange len cur / 2 tmp = cur 2 * i cur 2 * i + 1 tmp sort key = lambda x join x merged append sum tmp cur = merged sorted_lineups append cur sorted_lineups sort key = lambda x x 0 print sorted_lineups rv = join sum sorted_lineups 0 assert len rv == 2 ** n return rv 		7 36
def read1 f l = f readline strip return map int l split 		38 40
